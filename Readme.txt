数据挖掘大作业：分类任务
学号：122106010753 姓名：陈晋
#————————————————————————————— 1.环境配置及代码执行 ———————————————————————————————————————#
1.项目环境：
操作系统:     WIN11
IDE:        Pycharm 2022.3
所需环境：
1) 使用Bert作为编码器进行预处理:
python==3.6.15  tensorflow==1.15.0  pandas==1.1.5   numpy==1.19.5
bert-serving-client==1.10.0     bert-serving-server==1.10.0
编码器的执行和预训练模型的下载见：
https://github.com/jina-ai/clip-as-service/tree/bert-as-service

2)分类算法的执行环境：
python==3.6.13  pytorch==1.10.2   pandas==1.1.5   numpy==1.19.5
scikit-learn==0.24.2
完整代码见：

由于空间限制，本次提交的代码仅包含BGL-2k的数据集和编码结果，以及BGL-100k的数据集。
BGL-100k的编码结果可从完整代码处下载。

配置好完整代码的环境后，只需执行main.py即可。默认使用五种算法，对BGL-2k数据集进行十次分类。
若要执行BGL-100k的分类，需下载BGL-100k的编码结果后，修改main中的root_dir和embed_dir为对应路径后执行。

#————————————————————————————— 2.分析和分类关联的数据和不相关的数据 ———————————————————————————————————————#
数据集：BGL2k, BGL100k(随机采样)
分类算法：
1.DT(决策树)；
2.SVM；
3.KNN；
4.MLP；
5.随机森林。

BGL数据集的数据结构：
Label  Timestamp  Date  Node  Time  NodeRepeat  Type  Component  Level  Content  EventId  EventTemplate

*Label:"-"为正常， 其余为异常；
Timestamp为10位时间戳；
Date为日期，年.月.日；
Node为发出结点；
Time为时间；
NodeRepeat为转述结点；
type:类别；
*Component:构成；
level:重要性；
**content:内容；
*EventId:事件id，不同事件表示不同的含义；
EventTemlate:事件模板；

从各类信息的含义来看，我们能够明显发现：
1.Timestamp，Date和Time大概率是与日志的标签是不相关的；
2.Node和NodeRepeat和日志标签的相关性也存疑虑，需要验证；
3.type只包含RAS和Null,与日志标签大概率不相关；
4.EventId和EventTemlate是一一对应的，只需保留EventId;

综上，日志数据的标签label的关联数据暂定Component,content和EventId三种;
若以EventId作为分类目标，则其关联数据暂定label,Component和content三种。


#————————————————————————————— 3.将数据转换为便于处理的编码 ———————————————————————————————————————#
不同数据的各自的类别总数：
Label len: 32
Component len: 11
Content len: 264063
因此，简单地使用one-hot编码是不合适的。

统计一下label和Component的类别内容;看看是否与最终的事件结果有关系；

最终，我们认为，Label和Component的内容与EventId相关性较低，因此不作为样本内容。

最终，我们使用Bert预训练模型，对Content进行编码，维度为768，作为样本数据；
EventId映射到1-380，作为样本标签。

#————————————————————————————— 4.训练和测试结果（BGL-2K） ———————————————————————————————————————#
训练/测试的划分比例为80%/20%。
训练时,我们获得十次不同划分的数据进行实验,计算平均准确率和时间：

1）SVM
平均准确率：0.9675。
平均 （数据划分+训练+预测） 时间：0.1739s。

2）KNN
平均准确率：0.9395。
平均 （数据划分+训练+预测） 时间：0.0216s。

3）DT(决策树)
平均准确率：0.9485。
平均 （数据划分+训练+预测） 时间：1.8965s。

4)MLP(多层感知机)
平均准确率：0.9652。
平均 （数据划分+训练+预测） 时间：2.5319s。

5)随机森林
平均准确率：0.9607。
平均 （数据划分+训练+预测） 时间：0.2349s。

#————————————————————————————— 5.训练和测试结果（BGL-100K） ———————————————————————————————————————#
1）SVM
平均准确率：0.9997。
平均 （数据划分+训练+预测） 时间：42.7919s。

2）KNN
平均准确率：0.9994。
平均 （数据划分+训练+预测） 时间：42.5052s。

3）DT(决策树)
平均准确率：0.9991。
平均 （数据划分+训练+预测） 时间：36.1964s。

4)MLP(多层感知机)
平均准确率：0.9990。
平均 （数据划分+训练+预测） 时间：52.4571s。

5)随机森林
平均准确率：0.9995。
平均 （数据划分+训练+预测） 时间：5.4790s。